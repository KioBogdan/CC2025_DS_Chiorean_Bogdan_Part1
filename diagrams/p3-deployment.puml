@startuml
title P3 - UML Deployment Diagram (Secured)

skinparam shadowing false

node "User Device" {
  artifact "Browser" as Browser
}

node "AWS Cloud" {
  node "Amazon Cognito" as Cognito {
    artifact "User Pool\nApp Client\nGroups\ncustom:device_id" as UP
  }
}

node "Azure Cloud" {
  node "Azure App Service\n(Frontend Web App)" as WebFE {
    artifact "React SPA" as React
  }

  node "Azure App Service\n(Backend API)" as WebAPI {
    artifact "FastAPI (Python)\nJWT validation\nBlob access" as FastAPI
  }

  node "Azure Storage Account" as Storage {
    artifact "Blob Container: processed\nlatest/*.json\nby-timestamp/*" as Blobs
  }

  node "Azure Data Factory" as DataFactory {
    artifact "Pipeline + Mapping Data Flow\nCSV -> JSON" as Pipeline
  }

  node "Monitoring" as Mon {
    artifact "App Service Logs" as ASLogs
    artifact "ADF Run Logs" as ADFLogs
  }
}

Browser --> React : HTTPS
React --> Cognito : Auth (SDK)\nOIDC tokens
React --> FastAPI : HTTPS\nBearer JWT

FastAPI --> Cognito : JWKS/issuer validation
FastAPI --> Blobs : Read latest JSON

Pipeline --> Blobs : Write latest + history JSON
Pipeline --> ADFLogs : Emit logs
FastAPI --> ASLogs : Emit logs

@enduml
